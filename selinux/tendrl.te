policy_module(tendrl, 1.0.0)

########################################
#
# Declarations
#

type tendrl_t;
type tendrl_exec_t;
init_daemon_domain(tendrl_t, tendrl_exec_t)

type tendrl_conf_t;
files_config_file(tendrl_conf_t)

type tendrl_log_t;
logging_log_file(tendrl_log_t)

type tendrl_var_lib_t;
files_type(tendrl_var_lib_t)

type tendrl_var_run_t;
files_pid_file(tendrl_var_run_t)

type tendrl_unit_file_t;
systemd_unit_file(tendrl_unit_file_t)

permissive tendrl_t;

########################################
#
# tendrl local policy
#
allow tendrl_t self:capability { sys_rawio sys_admin net_admin };
allow tendrl_t self:capability2 block_suspend;
allow tendrl_t self:fifo_file rw_fifo_file_perms;
allow tendrl_t self:unix_stream_socket create_stream_socket_perms;
allow tendrl_t self:tcp_socket { accept listen };
allow tendrl_t self:netlink_route_socket nlmsg_write;

allow tendrl_t tendrl_conf_t:dir manage_dir_perms;
allow tendrl_t tendrl_conf_t:file manage_file_perms;

manage_dirs_pattern(tendrl_t, tendrl_log_t, tendrl_log_t)
manage_files_pattern(tendrl_t, tendrl_log_t, tendrl_log_t)
manage_lnk_files_pattern(tendrl_t, tendrl_log_t, tendrl_log_t)
logging_log_filetrans(tendrl_t, tendrl_log_t, { dir file lnk_file })

manage_dirs_pattern(tendrl_t, tendrl_var_lib_t, tendrl_var_lib_t)
manage_files_pattern(tendrl_t, tendrl_var_lib_t, tendrl_var_lib_t)
exec_files_pattern(tendrl_t, tendrl_var_lib_t, tendrl_var_lib_t)
manage_lnk_files_pattern(tendrl_t, tendrl_var_lib_t, tendrl_var_lib_t)
files_var_lib_filetrans(tendrl_t, tendrl_var_lib_t, { dir file lnk_file })

manage_sock_files_pattern(tendrl_t, tendrl_var_run_t, tendrl_var_run_t)
files_pid_filetrans(tendrl_t, tendrl_var_run_t, sock_file)

kernel_read_system_state(tendrl_t)
kernel_read_unix_sysctls(tendrl_t)
kernel_read_net_sysctls(tendrl_t)
kernel_read_software_raid_state(tendrl_t)
kernel_read_ring_buffer(tendrl_t)

auth_read_passwd(tendrl_t)

corecmd_exec_shell(tendrl_t)
corecmd_exec_bin(tendrl_t)

corenet_tcp_bind_generic_node(tendrl_t)
corenet_tcp_bind_http_cache_port(tendrl_t)
corenet_tcp_bind_transproxy_port(tendrl_t)
corenet_tcp_connect_mongod_port(tendrl_t)
corenet_tcp_connect_amanda_port(tendrl_t)
corenet_tcp_connect_lmtp_port(tendrl_t)
corenet_tcp_connect_pki_kra_port(tendrl_t)
corenet_tcp_bind_pki_kra_port(tendrl_t)
corenet_tcp_connect_ssh_port(tendrl_t)
corenet_tcp_connect_xen_port(tendrl_t)

dev_read_sysfs(tendrl_t)
dev_read_kmsg(tendrl_t)
dev_read_raw_memory(tendrl_t)

init_read_state(tendrl_t)

libs_exec_ldconfig(tendrl_t)

miscfiles_read_hwdata(tendrl_t)

sysnet_dns_name_resolve(tendrl_t)
sysnet_exec_ifconfig(tendrl_t)

optional_policy(`
	dmesg_exec(tendrl_t)
')

optional_policy(`
	dmidecode_exec(tendrl_t)
')

optional_policy(`
    gnome_read_home_config(tendrl_t)
')

optional_policy(`
    systemd_hostnamed_read_config(tendrl_t)
    systemd_exec_systemctl(tendrl_t)
')

optional_policy(`
	dbus_system_bus_client(tendrl_t)
')

files_list_var(tendrl_t)
